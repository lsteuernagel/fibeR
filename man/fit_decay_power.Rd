% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/processing_functions.R
\name{fit_decay_power}
\alias{fit_decay_power}
\title{Fit an exponential decay to estimate fiber photometry baseline with bleaching.}
\usage{
fit_decay_power(
  data,
  smooth_with_butter = TRUE,
  pct_fallback = 0.2,
  b_val = 0.5,
  ntry = 0,
  verbose = 0
)
}
\arguments{
\item{data}{Numeric vector of the signal to be fitted (y)}

\item{smooth_with_butter}{apply low pass butter filter t smooth the data ?}

\item{pct_fallback}{when the model fitting fails the data is restricted to the maximum within in the first pct_fallback \% (e.20\%) and the minimum in the last 20\%}

\item{b_val}{manually defined starting value for formula: y ~ a*(1-(1-b)*(x/c))^(1/(1-b))}

\item{ntry}{parameter to stop recursion when functions calls itself (defaults to 0 when called by user). Function will not run if bigger than > 10}

\item{verbose}{0=nothing, 1= only errors, 2: messages 3 plot}
}
\value{
List. reference_data: Fitted values with model or median. fit_model: Model from stats::nls, if possible.
}
\description{
Fit an exponential decay using a power like model adapted from:
https://www.sciencedirect.com/science/article/pii/S0006349503745032?via\%3Dihub
}
\details{
Additionally smoothes the data with a low-pass butter filter before trying to fit the model with stats::nls
If model fitting fails, it tries to change the input data to max (at the start) and min (at the end) and optionally artificially elongates the the 'tail' with the minimum value.

TODO: describe params
}
